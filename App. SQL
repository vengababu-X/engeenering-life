-- Smart Vision AI Database Schema
-- Created by Vengababu

-- Users Table
CREATE TABLE IF NOT EXISTS users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    email VARCHAR(150) UNIQUE NOT NULL,
    mobile VARCHAR(15),
    branch VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Courses Table
CREATE TABLE IF NOT EXISTS courses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(150) NOT NULL,
    description TEXT,
    branch VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Units Table
CREATE TABLE IF NOT EXISTS units (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
    title VARCHAR(150) NOT NULL,
    content TEXT,
    video_url TEXT,
    audio_url TEXT,
    pdf_url TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Enrollments Table
CREATE TABLE IF NOT EXISTS enrollments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
    enrolled_at TIMESTAMP DEFAULT NOW()
);

-- Unit Progress Table
CREATE TABLE IF NOT EXISTS unit_progress (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    unit_id UUID REFERENCES units(id) ON DELETE CASCADE,
    completed BOOLEAN DEFAULT FALSE,
    completed_at TIMESTAMP
);

-- Chat History Table (for Smart Vision AI Chatbot)
CREATE TABLE IF NOT EXISTS chat_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    message TEXT NOT NULL,
    response TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Insert default admin user (Vengababu)
INSERT INTO users (name, email, mobile, branch)
VALUES ('Vengababu', 'admin@smartvision.ai', '9999999999', 'AI')
ON CONFLICT (email) DO NOTHING;

-- Insert sample courses
INSERT INTO courses (title, description, branch) VALUES
('AI Fundamentals', 'Introduction to Artificial Intelligence concepts', 'AI'),
('IoT Essentials', 'Basics of Internet of Things applications', 'IOT'),
('Machine Learning', 'Core concepts of ML with practical examples', 'AIML'),
('Electronics & Communication', 'ECE core concepts with practical applications', 'ECE'),
('Computer Science Basics', 'Fundamentals of CSE for beginners', 'CSE');
